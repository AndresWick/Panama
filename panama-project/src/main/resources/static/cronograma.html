<style>
	.txtBusqueda {
		width: 30%;
		margin-left: auto;
		margin-right: auto;
	}

	.pnl_busqueda {
		text-align: center;
		color: #444;
	}
	
	.modal-backdrop.fade.in {
    	display: none;
	}
	
	.modal {
    	background-color: rgba(0,0,0,0.5)!important;
	}

	.widget-title {
		text-align: center;
		text-shadow: 1px 1px 2px #444;
		color: #444;
	}

	@media ( max-width : 600px) {
		.txtBusqueda {
			width: 50%;
			margin-top: 2%;
			margin-left: auto;
			margin-right: auto;
		}
		.card-view {
    		padding-left: 30%;
		}
	}

	@media ( max-width : 400px) {
		.card-view {
    		padding-left: 0%;
		}
	}
	
	@media (min-width:601px){
		.card-view {
    		padding-left: 30%;
		}
	}
	
	.no-records-found{
		display:none;
	}
	
	#closeExit {
    	margin-top: -20px;
	}
	
	th{
	 	width: 130px;
  		overflow: auto;
  		vertical-align: middle!important;
    	text-align: center;
	}
	
	#full-size{
    height: 100%;
    width: 100%;
    left: 0;
    top: 0;
    overflow: hidden;
    position: fixed;
    z-index:100;
    background-color:#21212175!important; 
	}
	
	
	#loader {
	      margin-top: 18rem;
	    margin-left: auto;
	    margin-right: auto;
	  z-index: 1;
	  border: 16px solid #f3f3f3;
	  border-radius: 50%;
	  border-top: 16px solid #3c2f2f;
	  border-right: 16px solid #c1c1c1;
	  border-bottom: 16px solid #372112;
	  border-left: 16px solid #c1c1c1;
	  width: 120px;
	  height: 120px;
	  -webkit-animation: spin 2s linear infinite;
	  animation: spin 2s linear infinite;
	}
	
	@-webkit-keyframes spin {
	  0% { -webkit-transform: rotate(0deg); }
	  100% { -webkit-transform: rotate(360deg); }
	}
	
	@keyframes spin {
	  0% { transform: rotate(0deg); }
	  100% { transform: rotate(360deg); }
	}
	
	/* Add animation to "page content" */
	.animate-bottom {
	  position: relative;
	  -webkit-animation-name: animatebottom;
	  -webkit-animation-duration: 1s;
	  animation-name: animatebottom;
	  animation-duration: 1s
	}
	
	@-webkit-keyframes animatebottom {
	  from { bottom:-100px; opacity:0 } 
	  to { bottom:0px; opacity:1 }
	}
	
	@keyframes animatebottom { 
	  from{ bottom:-100px; opacity:0 } 
	  to{ bottom:0; opacity:1 }
	}
	

</style>
<meta charset="ISO-8859-1">

<div id="full-size">
  <div id="loader"></div>
  
</div>

<div id="busqUsuarios" class="widget-box">
	<div class="widget-title">
		<h2 id="title_usuarios">Registrar Cronograma</h2>
	</div>
	<div class="widget-content nopadding">
		<div class="pnl_busqueda">
			<div>Fecha</div>
			<input id="fechaCronograma" type="date" placeholder="Fecha dd-mm-yyyy" class="form-control txtBusqueda" required />
			<br>
		
			<table class="table">
			  <thead>
			    <tr>
			      <th scope="col"><b>Tipo Buque</b></th>
			      <th scope="col"><b>Sentido</b></th>
			      <th scope="col"><b>Primer Periodo</b></th>
			      <th scope="col"><b>Segundo Periodo</b></th>
			      <th scope="col"><b>Tercer Periodo</b></th>
			      <th scope="col"><b>Periodo Especial</b></th>
			    </tr>
			  </thead>
			  <tbody>
			    <tr>
			    	<th scope="row">Regular</th>
			    	 <td>
			    	 	<br>
			      		<div>Norte</div>
			      		<br>
			      		<div>Sur</div>
					</td>
			  		<td>
			  			<input id="qmax_regular_p1_norte" name="gender" class="form-control " type="number">
			  			<input id="qmax_regular_p1_sur" name="gender" class="form-control " type="number">
			  		</td>
				    <td>
				    	<input id="qmax_regular_p2_norte" name="gender" class="form-control " type="number">
			  			<input id="qmax_regular_p2_sur" name="gender" class="form-control " type="number">
			  		</td>
				    <td>
				    	<input id="qmax_regular_p3_norte" name="gender" class="form-control " type="number">
			  			<input id="qmax_regular_p3_sur" name="gender" class="form-control " type="number">
				    </td>
				    <td>
				    	<input id="qmax_regular_p4_norte" name="gender" class="form-control " type="number">
			  			<input id="qmax_regular_p4_sur" name="gender" class="form-control " type="number">
				    </td>
			    </tr>
			    <tr>
			    	<th scope="row">Super</th>
			    	 <td>
			    	 	<br>
			      		<div>Norte</div>
			      		<br>
			      		<div>Sur</div>
					</td>
				    <td>
				    	<input id="qmax_super_p1_norte" name="gender" class="form-control " type="number">
				    	<input id="qmax_super_p1_sur" name="gender" class="form-control " type="number">
				    </td>
				    <td>
				    	<input id="qmax_super_p2_norte" name="gender" class="form-control " type="number">
				    	<input id="qmax_super_p2_sur" name="gender" class="form-control " type="number">
				    </td>
				    <td>
				    	<input id="qmax_super_p3_norte" name="gender" class="form-control " type="number">
				    	<input id="qmax_super_p3_sur" name="gender" class="form-control " type="number">
				    </td>
				    <td>
				    	<input id="qmax_super_p4_norte" name="gender" class="form-control " type="number">
				    	<input id="qmax_super_p4_sur" name="gender" class="form-control " type="number">
				    </td>
			    </tr>
			    <tr>
			      <th scope="row">Neopanamax</th>
			       <td>
			       		<br>
			      		<div>Norte</div>
			      		<br>
			      		<div>Sur</div>
					</td>
			     	<td>
			     		<input id="qmax_neopanamax_p1_norte" name="gender" class="form-control " type="number">
			     		<input id="qmax_neopanamax_p1_sur" name="gender" class="form-control " type="number">
			     	</td>
				    <td>
				    	<input id="qmax_neopanamax_p2_norte" name="gender" class="form-control " type="number">
				    	<input id="qmax_neopanamax_p2_sur" name="gender" class="form-control " type="number">
				    </td>
				    <td>
				    	<input id="qmax_neopanamax_p3_norte" name="gender" class="form-control " type="number">
				    	<input id="qmax_neopanamax_p3_sur" name="gender" class="form-control " type="number">
				    </td>
				    <td>
				    	<input id="qmax_neopanamax_p4_norte" name="gender" class="form-control " type="number">
				    	<input id="qmax_neopanamax_p4_sur" name="gender" class="form-control " type="number">
				    </td>
			    </tr>
			</tbody>
	      </table>
		<div>
			<button class="btn btn-success"  onclick="registarCronograma()">Registrar Cronograma</button>
		</div>
		</div>
	</div>
</div>

	<!-- Central Modal Invalid Cant -->
			<div class="modal fade" id="modal_invalid_cant" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
				<div class="modal-dialog modal-notify modal-danger" role="document">
    				<!--Content-->
    				<div class="modal-content">
        				<!--Header-->
        				<div class="modal-header">
            				<p class="heading lead">Cantidad excedida de cupos permitidos.</p>
            				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
               	 				<span aria-hidden="true" class="white-text">&times;</span>
            				</button>
        				</div>
        				<!--Body-->
        				<div class="modal-body">
				            <div class="text-center">
				                <i class="fa fa-times fa-4x mb-3 animated rotateIn"></i>
				                <p>Solo se pueden registrar hasta un maximo de 25 cupos diarios.</p>
				            </div>
				        </div>
				        <!--Footer-->
				        <div class="modal-footer justify-content-center">
				            <a type="button" class="btn btn-danger" data-dismiss="modal">Aceptar <i class="fa fa-check ml-1"></i></a>
				        </div>
				    </div>
   				<!--/.Content-->
				</div>
			</div>
			<!-- End Central Modal Invalid Cant-->

<script type="text/javascript">

	var valores=["#qmax_regular_p1_norte","#qmax_regular_p1_sur","#qmax_regular_p2_norte","#qmax_regular_p2_sur","#qmax_regular_p3_norte","#qmax_regular_p3_sur","#qmax_regular_p4_norte","#qmax_regular_p4_sur","#qmax_super_p1_norte","#qmax_super_p1_sur","#qmax_super_p2_norte","#qmax_super_p2_sur","#qmax_super_p3_norte","#qmax_super_p3_sur","#qmax_super_p4_norte","#qmax_super_p4_sur","#qmax_neopanamax_p1_norte","#qmax_neopanamax_p1_sur","#qmax_neopanamax_p2_norte","#qmax_neopanamax_p2_sur","#qmax_neopanamax_p3_norte","#qmax_neopanamax_p3_sur","#qmax_neopanamax_p4_norte","#qmax_neopanamax_p4_sur"];
	var adds=0;
	
	function validate(){
		for(var i=0;i<valores.length;i++){
			if($(valores[i]).val()=="" || $(valores[i]).val()<0){
				$(valores[i]).val(0);
			}
		}
	}

	function registarCronograma(){
		validate();
		var maxCant=25;
		var cont=0;
		for(var i=0;i<valores.length;i++){
			cont=cont+parseInt($(valores[i]).val());
			adds++;
		}
		if(cont>maxCant){
  	      $("#modal_invalid_cant").modal("show");
		}else{
			var k_tipoBuque= null;
			var k_fecha=document.getElementById("fechaCronograma").value;
			var k_idPer=null;
			var k_sentido=null;
			var q_cupos_max=null;
			
			for(var i=0;i<valores.length;i++){
				
				q_cupos_max=$(valores[i]).val();
				
				if(i>=0 && i<=7){
					k_tipoBuque=1;
				}else if(i>=8 && i<=15){
					k_tipoBuque=2;
				}else if(i>15){
					k_tipoBuque=3;
				}
				
				if(i==0 || i==1 || i==8 || i==9 || i==16 || i==17){
					k_idPer=1;
				}else if(i==2 || i==3 || i==10 || i==11 || i==18 || i==19){
					k_idPer=2;
				}else if(i==4 || i==5 || i==12 || i==13 || i==20 || i==21){
					k_idPer=3;
				}else if(i==6 || i==7 || i==14 || i==15 || i==22 || i==23){
					k_idPer=4;
				}
				
				if(i % 2 == 0){
					k_sentido="Norte";
				}else {
					k_sentido="Sur";
				}
			//	alert("tipo buque: "+k_tipoBuque+" fecha: "+k_fecha+" periodo: "+k_idPer+" sentido: "+k_sentido+" cupos: "+q_cupos_max);
				addCronograma(k_tipoBuque,k_fecha,k_idPer,k_sentido,q_cupos_max);
			}

		}
	}
	
	function addCronograma(k_tipoBuque,k_fecha,k_idPer,k_sentido,q_cupos_max){
		   var categorias=[];
			   
			   var promiseCount = 0;
			   var top=adds;

			   function testPromise() {
				document.getElementById("full-size").style.display = "block";
			     var thisPromiseCount = ++promiseCount;

			     var p1 = new Promise(
			       // La función resolvedora es llamada con la
			       // habilidad de resolver o rechazar la promesa
			       function(resolve, reject) {
			    	   
			    		$.ajax({
			    	        url: 'cronograma',
			    	        type: 'POST',
			    	        data: JSON.stringify({
			    	        	k_tipoBuque: k_tipoBuque,
			    	        	k_fecha:k_fecha,
			    	        	k_idPer:k_idPer,
			    	        	k_sentido:k_sentido,
			    	        	q_cupos_max:q_cupos_max
			    	            }),
			    	        processData: false,
			    	        contentType: "application/json",
			    	        success:function(data){
			    	    		console.log("registrando");
			    	        	alert(data);
								 document.getElementById("full-size").style.display = "none";
			    	        },
			    	        error:function(data){
			    	        	alert(data.responseText)
								 document.getElementById("full-size").style.display = "none";
			    	        }
			    	    })
			       }
			     );

			     p1.then(
			       function(cat) {
			    	   if(thisPromiseCount<top){	   
			    		   testPromise();
			    	   }	   
						document.getElementById("full-size").style.display = "none";
			       })
			       .catch(
			       // Registrar la razón del rechazo
			       function(reason) {
					 document.getElementById("full-size").style.display = "none";
			         console.log('Manejar promesa rechazada ('+reason+') aquí.');
			       });
			   }
			   testPromise();	    		  
		}
	
</script>




