--   -------------------------------------------------- 
--   Generated by Enterprise Architect Version 8.0.856
--   Created On : sábado, 23 febrero, 2019 
--   DBMS       : Oracle 
--   -------------------------------------------------- 



--  Drop Tables, Stored Procedures and Views 

DROP TABLE banco CASCADE CONSTRAINTS
;
DROP TABLE concepto CASCADE CONSTRAINTS
;
DROP TABLE cuenta CASCADE CONSTRAINTS
;
DROP TABLE detallemovimiento CASCADE CONSTRAINTS
;
DROP TABLE movimiento CASCADE CONSTRAINTS
;
DROP TABLE titular CASCADE CONSTRAINTS
;

--  Create Tables 
CREATE TABLE banco
(
	k_id      NUMBER(3) NOT NULL,    --  Identificador del banco. 
	n_nombre  VARCHAR(30) NOT NULL    --  Nombre del banco. 
)
;

COMMENT ON TABLE banco IS 'Representa los diferentes bancos a los que pertenecen las cuentas.'
;
COMMENT ON COLUMN banco.k_id      IS 'Identificador del banco.'
;
COMMENT ON COLUMN banco.n_nombre  IS 'Nombre del banco.'
;

CREATE TABLE concepto
(
	k_concepto     NUMBER(3) NOT NULL,    --  Identificador del concepto. 
	n_descripcion  VARCHAR(50) NOT NULL    --  Descripción del concepto. 
)
;

COMMENT ON TABLE concepto IS 'Contiene los diferentes conceptos de movimientos.'
;
COMMENT ON COLUMN concepto.k_concepto     IS 'Identificador del concepto.'
;
COMMENT ON COLUMN concepto.n_descripcion  IS 'Descripción del concepto.'
;

CREATE TABLE cuenta
(
	k_id         NUMBER(3) NOT NULL,    --  Identificador de la cuenta. 
	k_idTitular  NUMBER(3) NOT NULL,    --  Identificador del titular de la cuenta. 
	v_saldo      NUMBER(8,2) NOT NULL,    --  Saldo de la cuenta. 
	v_clave      NUMBER(4) NOT NULL,    --  Clave de acceso de la cuenta. 
	k_idBanco    NUMBER(3) NOT NULL    --  Identificador del banco de la cuenta. 
)
;

COMMENT ON TABLE cuenta IS 'Contiene las diferentes cuentas de un banco.'
;
COMMENT ON COLUMN cuenta.k_id         IS 'Identificador de la cuenta.'
;
COMMENT ON COLUMN cuenta.k_idTitular  IS 'Identificador del titular de la cuenta.'
;
COMMENT ON COLUMN cuenta.v_saldo      IS 'Saldo de la cuenta.'
;
COMMENT ON COLUMN cuenta.v_clave      IS 'Clave de acceso de la cuenta.'
;
COMMENT ON COLUMN cuenta.k_idBanco    IS 'Identificador del banco de la cuenta.'
;

CREATE TABLE detallemovimiento
(
	k_detalle     NUMBER(3) NOT NULL,    --  Identificador del detalle. 
	k_concepto    NUMBER(3) NOT NULL,    --  Llave foranea del concepto. 
	k_movimiento  NUMBER(5) NOT NULL    --  Llave foranea que relaciona al movimiento. 
)
;

COMMENT ON TABLE detallemovimiento IS 'Contiene los diferentes detalles movimientos.'
;
COMMENT ON COLUMN detallemovimiento.k_detalle     IS 'Identificador del detalle.'
;
COMMENT ON COLUMN detallemovimiento.k_concepto    IS 'Llave foranea del concepto.'
;
COMMENT ON COLUMN detallemovimiento.k_movimiento  IS 'Llave foranea que relaciona al movimiento.'
;

CREATE TABLE movimiento
(
	k_id        NUMBER(5) NOT NULL,    --  Identificador del movimiento. 
	v_valor     NUMBER(8,2) NOT NULL,    --  Valor del movimiento. 
	f_fecha     DATE NOT NULL,    --  Fecha en que se realiza el movimiento. 
	i_estado    CHAR(1) NOT NULL,    --  Estado en el que se encuentra el movimiento. 
	k_idCuenta  NUMBER(3) NOT NULL    --  Identificador de la cuenta. 
)
;

COMMENT ON TABLE movimiento IS 'Contiene los diferentes movimientos de una cuenta.'
;
COMMENT ON COLUMN movimiento.k_id        IS 'Identificador del movimiento.'
;
COMMENT ON COLUMN movimiento.v_valor     IS 'Valor del movimiento.'
;
COMMENT ON COLUMN movimiento.f_fecha     IS 'Fecha en que se realiza el movimiento.'
;
COMMENT ON COLUMN movimiento.i_estado    IS 'Estado en el que se encuentra el movimiento.'
;
COMMENT ON COLUMN movimiento.k_idCuenta  IS 'Identificador de la cuenta.'
;

CREATE TABLE titular
(
	k_id        NUMBER(3) NOT NULL,    --  Identificador del titular. 
	n_nombre    VARCHAR(30) NOT NULL,    --  Nombre del titular. 
	n_apellido  VARCHAR(30) NOT NULL    --  Apellido del titular. 
)
;

COMMENT ON TABLE titular IS 'Representa el titular de cada cuenta.'
;
COMMENT ON COLUMN titular.k_id        IS 'Identificador del titular.'
;
COMMENT ON COLUMN titular.n_nombre    IS 'Nombre del titular.'
;
COMMENT ON COLUMN titular.n_apellido  IS 'Apellido del titular.'
;


--  Create Primary Key Constraints 
ALTER TABLE banco ADD CONSTRAINT PK_banco 
	PRIMARY KEY (k_id) 
 USING INDEX 
;

ALTER TABLE concepto ADD CONSTRAINT PK_concepto 
	PRIMARY KEY (k_concepto) 
 USING INDEX 
;

ALTER TABLE cuenta ADD CONSTRAINT PK_cuenta 
	PRIMARY KEY (k_id) 
 USING INDEX 
;

ALTER TABLE detallemovimiento ADD CONSTRAINT PK_detalleconcepto 
	PRIMARY KEY (k_detalle) 
 USING INDEX 
;

ALTER TABLE movimiento ADD CONSTRAINT PK_movimiento 
	PRIMARY KEY (k_id) 
 USING INDEX 
;

ALTER TABLE titular ADD CONSTRAINT PK_titular 
	PRIMARY KEY (k_id) 
 USING INDEX 
;


--  Create Indexes 
ALTER TABLE movimiento
ADD CONSTRAINT CK_i_estado CHECK (i_estado in ('E','R'))
;


--  Create Foreign Key Constraints 
ALTER TABLE cuenta ADD CONSTRAINT FK_cuenta_banco 
	FOREIGN KEY (k_idBanco) REFERENCES banco (k_id)
;

ALTER TABLE cuenta ADD CONSTRAINT FK_cuenta_titular 
	FOREIGN KEY (k_idTitular) REFERENCES titular (k_id)
;

ALTER TABLE detallemovimiento ADD CONSTRAINT FK_detallemovimiento_movimiento 
	FOREIGN KEY (k_movimiento) REFERENCES movimiento (k_id)
;

ALTER TABLE movimiento ADD CONSTRAINT FK_movimiento_cuenta 
	FOREIGN KEY (k_idCuenta) REFERENCES cuenta (k_id)
;
